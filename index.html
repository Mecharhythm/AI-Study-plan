<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>AI Study Planner</title>


<div id="auth" class="box">
  <h2>ログイン / 新規登録</h2>
  <input id="user" placeholder="ユーザーID"><br><br>
  <input id="pass" placeholder="パスワード" type="password"><br><br>

  <button onclick="login()">ログイン</button>
  <button onclick="register()">新規登録</button>

  <p id="msg" style="color:red;"></p>
<script>

// 新規登録
function register() {
  const u = user.value;
  const p = pass.value;

  if (!u || !p) {
    msg.textContent = "IDとパスワードを入力してください。";
    return;
  }

  if (localStorage.getItem(u)) {
    msg.textContent = "このIDは既に登録されています。";
    return;
  }

  localStorage.setItem(u, p);
  msg.textContent = "登録完了！ログインできます。";
}

// ログイン
function login() {
  const u = user.value;
  const p = pass.value;

  const saved = localStorage.getItem(u);

  if (saved === p) {
    document.getElementById("auth").style.display = "none";
    document.getElementById("main").style.display = "block";
  } else {
    msg.textContent = "IDまたはパスワードが違います。";
  }
}

// ログアウト
function logout() {
  document.getElementById("auth").style.display = "block";
  document.getElementById("main").style.display = "none";
}
</script>
</div>

<div id="main">
<style>
    body {
        font-family: sans-serif;
        background: #fff;
        margin: 0;
        padding: 0;
    }
    header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        padding: 14px;
        font-size: 20px;
        font-weight: bold;
        background: #ffffff;
        border-bottom: 1px solid #eee;
    }
    #tutorialBtn {
        font-size: 12px;
        padding: 4px 6px;
        border-radius: 6px;
        border: 1px solid #ccc;
        background: #f8f8f8;
    }
    #loginSection, #plannerSection {
        padding: 16px;
    }

    /* 横スクロール学習計画表 */
    #planScroll {
        display: flex;
        overflow-x: auto;
        gap: 12px;
        padding: 12px;
        background: #fafafa;
        border-bottom: 1px solid #ddd;
    }
    .plan-card {
        min-width: 140px;
        padding: 12px;
        border-radius: 12px;
        background: #f0f0f0;
    }

    /* 予定要約欄 */
    #summaryBox {
        background: #ffffff;
        border-top: 1px solid #ddd;
        border-bottom: 1px solid #ddd;
        padding: 16px;
        min-height: 80px;
        font-size: 15px;
    }

    /* 会話入力 */
    #chatContainer {
        padding: 16px;
    }
    #chatLog {
        height: 180px;
        overflow-y: auto;
        border: 1px solid #ccc;
        padding: 12px;
        border-radius: 10px;
        margin-bottom: 10px;
        background: #fafafa;
    }
    #prompt {
        width: 100%;
        padding: 10px;
        border-radius: 8px;
        border: 1px solid #ccc;
        margin-bottom: 10px;
    }
    #sendBtn {
        width: 100%;
        padding: 10px;
        border-radius: 8px;
        background: black;
        color: white;
        font-size: 16px;
        border: none;
    }
</style>
</head>
<body>
</div>

<header>
    AI Study Planner
    <button id="tutorialBtn">？使い方</button>
</header>

<!-- ▼▼ Firebaseログイン ▼▼ -->


<!-- ▼▼ ログイン後のプランナー画面 ▼▼ -->
<section id="plannerSection" style="display:none;">

    <!-- 横スクロール計画 -->
    <div id="planScroll"></div>

    <!-- 要約 -->
    <div id="summaryBox">ここにAIが簡潔な要約を表示します</div>

    <!-- 会話UI -->
    <div id="chatContainer">
        <div id="chatLog"></div>
        <textarea id="prompt" placeholder="例：今週の数学と化学の学習計画を作って" ></textarea>
        <button id="sendBtn">AIに送信</button>
    </div>
</section>

<script type="module">

  <button onclick="logout()">ログアウト</button>

/* ---------------------------
   Firebase初期化
--------------------------- */

/* ---------------------------
    DeepSeek への API 呼び出し
--------------------------- */
async function askDeepSeek(prompt) {

    const apiKey = "AIStadyplan";  // ←書き換えてね

    const response = await fetch("https://api.deepseek.com/v1/chat/completions", {
        method: "POST",
        headers: {
            "Authorization": `Bearer ${6bca8b0b-5bd6-4f30-84c0-bc242e746786}`,
            "Content-Type": "application/json"
        },
        body: JSON.stringify({
            model: "deepseek-chat",
            messages: [{ role: "user", content: prompt }]
        })
    });

    const data = await response.json();
    return data.choices[0].message.content;
}

/* ---------------------------
    UIの動作
--------------------------- */

document.getElementById("sendBtn").onclick = async () => {
    const input = document.getElementById("prompt").value;
    if (!input.trim()) return;

    // 会話ログ表示
    const log = document.getElementById("chatLog");
    log.innerHTML += `<div><b>あなた：</b>${input}</div>`;

    const reply = await askDeepSeek(input);

    log.innerHTML += `<div><b>AI：</b>${reply}</div>`;
    log.scrollTop = log.scrollHeight;

    // 要約欄にAIの返答を載せる
    document.getElementById("summaryBox").innerText = reply;

    // 横スクロールにもカード追加（仮）
    const planArea = document.getElementById("planScroll");
    const card = document.createElement("div");
    card.className = "plan-card";
    card.innerHTML = reply.substring(0,60) + "...";
    planArea.appendChild(card);

    document.getElementById("prompt").value = "";
};

/* ---------------------------
   チュートリアル
--------------------------- */
document.getElementById("tutorialBtn").onclick = () => {
    alert(
        "【使い方】\n\n1. まずログイン / 登録\n2. 下の入力欄に『今週の数学を計画して』などと入力\n3. AIが計画を作成し、要約とカードに追加されます\n4. 色分けは「予定を青系で色分けして」などと指示できます"
    );
};
</script>

</body>
</html>










